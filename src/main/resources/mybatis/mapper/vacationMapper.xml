<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.root34.aurora.vacation.dao.VacationMapper">

    <select id="selectVacation" resultType="hashmap">
        SELECT
               REMAIN_VACATION

          FROM TBL_VACATION
         WHERE MEMBER_CODE = #{ memberCode }
           AND VACATION_NO = #{ vacationNo }

    </select>

    <select id="selectUsedVacation" resultType="hashmap">
        SELECT

            IF(IS_HALF_DAY, 0.5, DATEDIFF(VACATION_END_DATE, VACATION_START_DATE) + 1) AS usedDay
        FROM TBL_USED_VACATION A
        JOIN TBL_VACATION B ON A.VACATION_NO = B.VACATION_NO
       WHERE B.MEMBER_CODE = #{ memberCode }

    </select>

    <update id="updateRemainVacation" parameterType="vacationDTO">

        UPDATE TBL_VACATION B
        SET REMAIN_VACATION = REMAIN_VACATION - (
            SELECT
                SUM(IF(A.IS_HALF_DAY, 0.5, DATEDIFF(A.VACATION_END_DATE, A.VACATION_START_DATE) + 1))
            FROM
                TBL_USED_VACATION A
            WHERE
                A.VACATION_NO = B.VACATION_NO
        )
        WHERE MEMBER_CODE = #{ memberCode }
          AND VACATION_NO = #{ vacationNo }


    </update>

</mapper>