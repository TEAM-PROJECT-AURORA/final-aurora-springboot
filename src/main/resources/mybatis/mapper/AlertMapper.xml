<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.root34.aurora.alert.dao.AlertMapper">
    <!--알림 등록-->
    <insert id="registerAlert" parameterType="AlertDTO">
        INSERT INTO TBL_ALERT
            (SENDER_MEMBER_CODE, SENDER_EMAIL, RECEIVER_MEMBER_CODE, ALERT_TYPE, MAIL_CODE, REPORT_CODE, ROUND_CODE, DETAIL_CODE, REPLY_CODE, APP_CODE)
        VALUES
            (#{senderMemberCode}, #{senderEmail}, #{receiverMemberCode}, #{alertType}, #{mailCode}, #{reportCode}, #{roundCode}, #{detailCode}, #{replyCode}, #{appCode})
    </insert>
    <!--알림 목록 조회-->
    <select id="selectAlertListByMemberCode" parameterType="Integer" resultType="AlertDTO">
        SELECT *
          FROM TBL_ALERT
         WHERE RECEIVER_MEMBER_CODE = #{ memberCode }
    </select>
    <!--알림 수정-->
    <update id="updateAlert" parameterType="AlertDTO">
        UPDATE TBL_ALERT
           SET READ_STATUS = 'Y'
         WHERE RECEIVER_MEMBER_CODE = #{receiverMemberCode}
           AND ALERT_TYPE = #{alertType}
           AND (
                   (ALERT_TYPE = '메일' AND MAIL_CODE = #{mailCode}) OR
                   (ALERT_TYPE = '보고' AND REPORT_CODE = #{reportCode}) OR
                   (ALERT_TYPE = '보고 회차' AND ROUND_CODE = #{roundCode}) OR
                   (ALERT_TYPE = '상세보고' AND DETAIL_CODE = #{detailCode}) OR
                   (ALERT_TYPE = '보고 댓글' AND REPLY_CODE = #{replyCode}) OR
                   (ALERT_TYPE = '결재' AND APP_CODE = #{appCode})
               )
    </update>
    <!--알림 읽기-->
    <update id="readAlert" parameterType="Long">
        UPDATE TBL_ALERT
           SET READ_STATUS = 'Y'
         WHERE ALERT_CODE = #{ alertCode }
    </update>
    <!--모든 알림 읽기-->
    <update id="readAllAlert" parameterType="Integer">
        UPDATE TBL_ALERT
           SET READ_STATUS = 'Y'
         WHERE RECEIVER_MEMBER_CODE = #{ memberCode }
    </update>
    <!--이메일로 멤버코드 조회-->
    <select id="getMemberCodeByEmail" parameterType="String" resultType="int">
        SELECT MEMBER_CODE
          FROM TBL_MEMBER
         WHERE MEMBER_EMAIL = #{ email }
    </select>
</mapper>